<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="searchs">
	
	<insert id="insert_comment" parameterType="hashmap">
		insert into comments(comment_id, uname, review_id, recipe_id, comment_text, parentcomment_id)
		values (seq_comment_id.nextval, #{uname}, null, #{recipe_id}, #{comment_text}, 0)
	</insert>
	
	<select id="comment_load" resultType="commentDTO" parameterType="String">
		WITH comment_recusive(LV, comment_id, parentcomment_id, uname, comment_text) AS (
		    SELECT 0 AS LV, comment_id, parentcomment_id, uname, comment_text
		    FROM comments 
		    WHERE parentcomment_id = 0 AND recipe_id = #{_parameter}
		    UNION ALL
		    SELECT CR.LV + 1 AS LV, C.comment_id, C.parentcomment_id, C.uname, C.comment_text
		    FROM comment_recusive CR LEFT OUTER JOIN comments C ON C.parentcomment_id = CR.comment_id
		    WHERE C.parentcomment_id != 0 AND recipe_id = #{_parameter}
		)
		SEARCH DEPTH FIRST BY comment_id SET ORDER_DEPTH
		SELECT * FROM comment_recusive
		ORDER BY ORDER_DEPTH
	</select>
	
	<select id="searchData" resultType="recipeDTO" parameterType="hashmap"> <!--   -->
		SELECT * FROM RECIPE
		<where>
			recipe_title LIKE '%' || #{recipe_title} || '%'
			<if test="order == 0">
				order by recipe_id desc
			</if>
			<if test= "oreder == 1">
				order by viewer desc
			</if>
			<if test= "order == 2">
			
			</if>
		</where> 
			
	</select>
	
	<select id="searchRecipe" resultType="recipeDTO" parameterType="String"> <!--   -->
		SELECT * FROM RECIPE
		WHERE recipe_id = #{_parameter}
	</select>
	
</mapper>